<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orimori - –ë–∞—Å“õ–∞—Ä—É –ø–∞–Ω–µ–ª—ñ</title>
  <meta name="description" content="Orimori –¥“Ø–∫–µ–Ω–¥–µ—Ä—ñ–Ω –±–∞—Å“õ–∞—Ä—É" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(180deg, hsl(35, 30%, 97%), hsl(35, 30%, 92%));
      min-height: 100vh;
      color: hsl(25, 15%, 20%);
      position: relative;
      overflow-x: hidden;
    }

    .rice-pattern {
      position: absolute;
      inset: 0;
      opacity: 0.03;
      background-image: 
        radial-gradient(circle at 20% 30%, hsl(25, 15%, 20%) 1px, transparent 1px),
        radial-gradient(circle at 60% 70%, hsl(25, 15%, 20%) 1px, transparent 1px),
        radial-gradient(circle at 80% 20%, hsl(25, 15%, 20%) 1px, transparent 1px);
      background-size: 40px 40px, 60px 60px, 50px 50px;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 10;
      max-width: 80rem;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
      animation: fadeInUp 0.7s ease-out;
    }

    .logo-card {
      display: inline-block;
      background: white;
      border-radius: 1.5rem;
      padding: 1.5rem;
      box-shadow: 0 4px 20px -4px rgba(60, 45, 40, 0.08);
      margin-bottom: 1rem;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .logo-card:hover {
      box-shadow: 0 8px 30px -6px rgba(232, 53, 78, 0.2);
    }

    .logo-card img {
      width: 12rem;
      height: auto;
      display: block;
    }

    h1 {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 1rem;
      color: hsl(25, 10%, 45%);
      margin-bottom: 1rem;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
    }

    .btn-primary {
      background: hsl(142, 76%, 36%);
      color: white;
      box-shadow: 0 4px 12px hsla(142, 76%, 36%, 0.3);
    }

    .btn-primary:hover {
      background: hsl(142, 76%, 32%);
      box-shadow: 0 6px 20px hsla(142, 76%, 36%, 0.4);
      transform: translateY(-2px);
    }

    .controls {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px -4px rgba(60, 45, 40, 0.08);
      animation: fadeInUp 0.7s ease-out 0.1s backwards;
    }

    .search-box {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid hsl(25, 10%, 85%);
      border-radius: 0.75rem;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .search-box:focus {
      outline: none;
      border-color: hsl(142, 76%, 36%);
      box-shadow: 0 0 0 3px hsla(142, 76%, 36%, 0.1);
    }

    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-group label {
      font-size: 0.875rem;
      font-weight: 600;
      color: hsl(25, 15%, 20%);
    }

    .filter-select {
      padding: 0.5rem;
      border: 1px solid hsl(25, 10%, 85%);
      border-radius: 0.5rem;
      font-size: 0.875rem;
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: hsl(142, 76%, 36%);
    }

    .stats {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .stat-badge {
      background: hsl(35, 30%, 95%);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      animation: fadeIn 0.7s ease-out 0.2s backwards;
    }

    .card {
      background: white;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 4px 20px -4px rgba(60, 45, 40, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card:hover {
      box-shadow: 0 8px 30px -6px rgba(60, 45, 40, 0.15);
      transform: translateY(-4px);
    }

    .card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: hsl(35, 30%, 95%);
    }

    .card-content {
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .card-info {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: hsl(25, 10%, 45%);
    }

    .card-info-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-info-label {
      font-weight: 600;
      color: hsl(25, 15%, 20%);
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-onigiri {
      background: hsla(142, 76%, 36%, 0.1);
      color: hsl(142, 76%, 36%);
    }

    .badge-sushiburger {
      background: hsla(355, 85%, 55%, 0.1);
      color: hsl(355, 85%, 55%);
    }

    .badge-credit {
      background: hsla(45, 100%, 50%, 0.1);
      color: hsl(45, 100%, 35%);
    }

    .badge-immediate {
      background: hsla(142, 76%, 36%, 0.1);
      color: hsl(142, 76%, 36%);
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-edit {
      flex: 1;
      background: hsl(142, 76%, 36%);
      color: white;
    }

    .btn-edit:hover {
      background: hsl(142, 76%, 32%);
    }

    .btn-delete {
      flex: 1;
      background: hsl(0, 84%, 60%);
      color: white;
    }

    .btn-delete:hover {
      background: hsl(0, 84%, 55%);
    }

    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.125rem;
      color: hsl(25, 10%, 45%);
    }

    .empty {
      text-align: center;
      padding: 3rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 20px -4px rgba(60, 45, 40, 0.08);
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .deco-circle-1 {
      position: absolute;
      top: 2.5rem;
      right: 2.5rem;
      width: 8rem;
      height: 8rem;
      background: hsla(355, 85%, 55%, 0.05);
      border-radius: 50%;
      filter: blur(3rem);
      pointer-events: none;
    }

    .deco-circle-2 {
      position: absolute;
      bottom: 5rem;
      left: 2.5rem;
      width: 10rem;
      height: 10rem;
      background: hsla(355, 85%, 55%, 0.05);
      border-radius: 50%;
      filter: blur(3rem);
      pointer-events: none;
    }

    .toast {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: none;
      animation: slideIn 0.3s ease-out;
      z-index: 1000;
      max-width: 400px;
    }

    .toast.show {
      display: block;
    }

    .toast.success {
      border-left: 4px solid hsl(142, 76%, 36%);
    }

    .toast.error {
      border-left: 4px solid hsl(0, 84%, 60%);
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .toast-description {
      font-size: 0.875rem;
      color: hsl(25, 10%, 45%);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(1rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @media (min-width: 640px) {
      h1 {
        font-size: 2.5rem;
      }

      .subtitle {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="rice-pattern"></div>
  <div class="deco-circle-1"></div>
  <div class="deco-circle-2"></div>

  <div class="container">
    <div class="header">
      <div class="logo-card">
        <img src="./assets/orimori-logo.png" alt="Orimori" />
      </div>
      <h1>–ë–∞—Å“õ–∞—Ä—É –ø–∞–Ω–µ–ª—ñ</h1>
      <p class="subtitle">–ë–∞—Ä–ª—ã“õ –¥“Ø–∫–µ–Ω–¥–µ—Ä</p>
      <a href="/" class="btn btn-primary">+ –ñ–∞“£–∞ –¥“Ø–∫–µ–Ω “õ–æ—Å—É</a>
    </div>

    <div class="controls">
      <input 
        type="text" 
        class="search-box" 
        id="searchBox" 
        placeholder="üîç –î“Ø–∫–µ–Ω –∞—Ç—ã –Ω–µ–º–µ—Å–µ –º–µ–∫–µ–Ω–∂–∞–π—ã –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É..."
      />

      <div class="filters">
        <div class="filter-group">
          <label>–¢–∞—É–∞—Ä</label>
          <select class="filter-select" id="filterProduct">
            <option value="">–ë–∞—Ä–ª—ã“ì—ã</option>
            <option value="onigiri">–û–Ω–∏–≥–∏—Ä–∏</option>
            <option value="sushiburger">–°—É—à–∏–±—É—Ä–≥–µ—Ä</option>
          </select>
        </div>

        <div class="filter-group">
          <label>–¢”©–ª–µ–º</label>
          <select class="filter-select" id="filterPayment">
            <option value="">–ë–∞—Ä–ª—ã“ì—ã</option>
            <option value="immediate">–ë—ñ—Ä–¥–µ–Ω —Ç”©–ª–µ–º</option>
            <option value="credit">“ö–∞—Ä—ã–∑“ì–∞</option>
          </select>
        </div>

        <div class="filter-group">
          <label>–°“±—Ä—ã–ø—Ç–∞—É</label>
          <select class="filter-select" id="sortBy">
            <option value="created_at_desc">–ñ–∞“£–∞–¥–∞–Ω –µ—Å–∫—ñ–≥–µ</option>
            <option value="created_at_asc">–ï—Å–∫—ñ–¥–µ–Ω –∂–∞“£–∞“ì–∞</option>
            <option value="price_desc">–ë–∞“ì–∞—Å—ã (–∂–æ“ì–∞—Ä—ã)</option>
            <option value="price_asc">–ë–∞“ì–∞—Å—ã (—Ç”©–º–µ–Ω)</option>
            <option value="name_asc">–ê—Ç–∞—É—ã (–ê-–Ø)</option>
            <option value="name_desc">–ê—Ç–∞—É—ã (–Ø-–ê)</option>
          </select>
        </div>
      </div>

      <div class="stats">
        <div class="stat-badge">–ë–∞—Ä–ª—ã“ì—ã: <span id="totalCount">0</span></div>
        <div class="stat-badge">–û–Ω–∏–≥–∏—Ä–∏: <span id="onigiriCount">0</span></div>
        <div class="stat-badge">–°—É—à–∏–±—É—Ä–≥–µ—Ä: <span id="sushiburgerCount">0</span></div>
        <div class="stat-badge">“ö–∞—Ä—ã–∑“ì–∞: <span id="creditCount">0</span></div>
      </div>
    </div>

    <div id="content">
      <div class="loading">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="toast-title" id="toastTitle"></div>
    <div class="toast-description" id="toastDescription"></div>
  </div>

  <script>
    const SUPABASE_URL = "https://gierevxpvsajtjdwethi.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZXJldnhwdnNhanRqZHdldGhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMTUzNzQsImV4cCI6MjA3ODg5MTM3NH0.LiVkWMW3MxPkGLhCYh5X8PrkBtWdYSn_nlgoUxrk-F8";

    let allStores = [];
    let filteredStores = [];

    // Toast notification
    function showToast(title, description, type = 'success') {
      const toast = document.getElementById('toast');
      const toastTitle = document.getElementById('toastTitle');
      const toastDescription = document.getElementById('toastDescription');

      toastTitle.textContent = title;
      toastDescription.textContent = description;
      toast.className = `toast ${type} show`;

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Load stores
    async function loadStores() {
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/stores?select=*`, {
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`
          }
        });

        if (!response.ok) {
          throw new Error('–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ');
        }

        allStores = await response.json();
        filteredStores = [...allStores];
        updateStats();
        applyFilters();
      } catch (error) {
        showToast('“ö–∞—Ç–µ', '–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã', 'error');
        document.getElementById('content').innerHTML = '<div class="empty"><div class="empty-icon">‚ùå</div><h2>“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã</h2></div>';
      }
    }

    // Update statistics
    function updateStats() {
      document.getElementById('totalCount').textContent = allStores.length;
      document.getElementById('onigiriCount').textContent = allStores.filter(s => s.product === 'onigiri').length;
      document.getElementById('sushiburgerCount').textContent = allStores.filter(s => s.product === 'sushiburger').length;
      document.getElementById('creditCount').textContent = allStores.filter(s => s.payment === 'credit').length;
    }

    // Apply filters and sorting
    function applyFilters() {
      const searchTerm = document.getElementById('searchBox').value.toLowerCase();
      const filterProduct = document.getElementById('filterProduct').value;
      const filterPayment = document.getElementById('filterPayment').value;
      const sortBy = document.getElementById('sortBy').value;

      // Filter
      filteredStores = allStores.filter(store => {
        const matchesSearch = store.name.toLowerCase().includes(searchTerm) || 
                            store.address.toLowerCase().includes(searchTerm);
        const matchesProduct = !filterProduct || store.product === filterProduct;
        const matchesPayment = !filterPayment || store.payment === filterPayment;
        
        return matchesSearch && matchesProduct && matchesPayment;
      });

      // Sort
      filteredStores.sort((a, b) => {
        switch (sortBy) {
          case 'created_at_desc':
            return new Date(b.created_at) - new Date(a.created_at);
          case 'created_at_asc':
            return new Date(a.created_at) - new Date(b.created_at);
          case 'price_desc':
            return b.price - a.price;
          case 'price_asc':
            return a.price - b.price;
          case 'name_asc':
            return a.name.localeCompare(b.name);
          case 'name_desc':
            return b.name.localeCompare(a.name);
          default:
            return 0;
        }
      });

      renderStores();
    }

    // Render stores
    function renderStores() {
      const content = document.getElementById('content');

      if (filteredStores.length === 0) {
        content.innerHTML = `
          <div class="empty">
            <div class="empty-icon">üì¶</div>
            <h2>–î“Ø–∫–µ–Ω–¥–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</h2>
            <p class="subtitle">–ñ–∞“£–∞ –¥“Ø–∫–µ–Ω “õ–æ—Å—ã“£—ã–∑ –Ω–µ–º–µ—Å–µ —Ñ–∏–ª—å—Ç—Ä–ª–µ—Ä–¥—ñ ”©–∑–≥–µ—Ä—Ç—ñ“£—ñ–∑</p>
          </div>
        `;
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'grid';

      filteredStores.forEach(store => {
        const card = document.createElement('div');
        card.className = 'card';
        
        const productLabel = store.product === 'onigiri' ? '–û–Ω–∏–≥–∏—Ä–∏' : '–°—É—à–∏–±—É—Ä–≥–µ—Ä';
        const paymentLabel = store.payment === 'immediate' ? '–ë—ñ—Ä–¥–µ–Ω —Ç”©–ª–µ–º' : '“ö–∞—Ä—ã–∑“ì–∞';
        const date = new Date(store.created_at).toLocaleDateString('kk-KZ');

        card.innerHTML = `
          ${store.photo ? `<img src="${store.photo}" alt="${store.name}" class="card-image" />` : '<div class="card-image"></div>'}
          <div class="card-content">
            <div class="card-title">${store.name}</div>
            <div class="card-info">
              <div class="card-info-row">
                <span class="card-info-label">üìç</span>
                <span>${store.address}</span>
              </div>
              <div class="card-info-row">
                <span class="card-info-label">üìû</span>
                <span>${store.phone}</span>
              </div>
              <div class="card-info-row">
                <span class="card-info-label">üç±</span>
                <span class="badge badge-${store.product}">${productLabel}</span>
              </div>
              <div class="card-info-row">
                <span class="card-info-label">üí∞</span>
                <span>${store.price} ‚Ç∏</span>
              </div>
              <div class="card-info-row">
                <span class="card-info-label">üí≥</span>
                <span class="badge badge-${store.payment}">${paymentLabel}</span>
              </div>
              <div class="card-info-row">
                <span class="card-info-label">üìÖ</span>
                <span>${date}</span>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn btn-edit" onclick="editStore(${store.id})">‚úèÔ∏è ”®“£–¥–µ—É</button>
              <button class="btn btn-delete" onclick="deleteStore(${store.id})">üóëÔ∏è –ñ–æ—é</button>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });

      content.innerHTML = '';
      content.appendChild(grid);
    }

    // Edit store
    function editStore(id) {
      window.location.href = `/?edit=${id}`;
    }

    // Delete store
    async function deleteStore(id) {
      if (!confirm('–î“Ø–∫–µ–Ω–¥—ñ –∂–æ–π“ì—ã“£—ã–∑ –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) {
        return;
      }

      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/stores?id=eq.${id}`, {
          method: 'DELETE',
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`
          }
        });

        if (!response.ok) {
          throw new Error('–ñ–æ—é “õ–∞—Ç–µ—Å—ñ');
        }

        showToast('–°”ô—Ç—Ç—ñ –∂–æ–π—ã–ª–¥—ã!', '–î“Ø–∫–µ–Ω –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ –∂–æ–π—ã–ª–¥—ã', 'success');
        loadStores(); // Reload stores
      } catch (error) {
        showToast('“ö–∞—Ç–µ', '–ñ–æ—é –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã', 'error');
      }
    }

    // Event listeners
    document.getElementById('searchBox').addEventListener('input', applyFilters);
    document.getElementById('filterProduct').addEventListener('change', applyFilters);
    document.getElementById('filterPayment').addEventListener('change', applyFilters);
    document.getElementById('sortBy').addEventListener('change', applyFilters);

    // Initial load
    loadStores();
  </script>
</body>
</html>
